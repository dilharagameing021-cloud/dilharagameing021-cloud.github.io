<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR කේත, ඔරලෝසු සහ දින දර්ශන යෙදුම</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the app */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #1a1a2e; color: #e0e0e0; }
        .app-container { background-color: #2a2a3e; }
        .tab-button {
            border-radius: 9999px;
            transition: background-color 0.3s, color 0.3s;
        }
        .tab-button.active {
            background-color: #4f46e5;
            color: white;
        }
        .sidebar { background-color: #16162a; }
        .sidebar-item.active { background-color: #4f46e5; color: white; }
        .card { background-color: #3e3e52; }
        .holiday { background-color: #881a1a; font-weight: bold; }
        .stopwatch-button { transition: background-color 0.3s, transform 0.2s; }
        .stopwatch-button:hover { transform: scale(1.1); }
        .stopwatch-display { font-variant-numeric: tabular-nums; }
        .lang-button.active {
            background-color: #4f46e5;
            color: white;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">
    <div class="absolute top-4 right-4 z-50 flex space-x-2">
        <button id="lang-si" class="lang-button bg-gray-700 text-white py-2 px-4 rounded-lg shadow-md hover:bg-gray-600 transition-colors duration-200 active">
            සිංහල
        </button>
        <button id="lang-en" class="lang-button bg-gray-700 text-white py-2 px-4 rounded-lg shadow-md hover:bg-gray-600 transition-colors duration-200">
            English
        </button>
        <button id="lang-ta" class="lang-button bg-gray-700 text-white py-2 px-4 rounded-lg shadow-md hover:bg-gray-600 transition-colors duration-200">
            தமிழ்
        </button>
    </div>

    <div class="app-container p-6 md:p-8 rounded-3xl shadow-2xl max-w-5xl w-full mx-4 flex flex-col md:flex-row text-left">

        <div id="auth-container" class="w-full text-center">
            <h1 id="auth-title" class="text-4xl font-extrabold text-white mb-6">QR කේත, ඔරලෝසු සහ දින දර්ශන යෙදුම</h1>
            <p id="auth-message" class="text-gray-400 mb-6">කරුණාකර ඔබගේ නම ඇතුළත් කරන්න.</p>
            <div id="login-form">
                <input type="text" id="user-name" placeholder="ඔබගේ නම" class="w-full p-4 mb-4 border border-gray-600 rounded-lg bg-gray-700 text-white focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:border-transparent transition-all duration-300">
                <button id="login-button" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-4 rounded-lg transition-colors transform hover:scale-105 duration-300 focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50 shadow-md">ඉදිරියට යන්න</button>
            </div>
        </div>

        <div id="main-app-container" class="hidden w-full flex flex-col md:flex-row">
            
            <div class="sidebar p-4 md:p-6 rounded-3xl md:w-64 flex-shrink-0 md:mr-8 mb-6 md:mb-0">
                <p id="user-info" class="text-sm text-gray-400 mb-6"></p>
                <ul class="space-y-4">
                    <li><button id="tab-qr" class="sidebar-item w-full py-3 px-4 rounded-lg text-left transition-colors duration-200 hover:bg-gray-700 flex items-center active"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4m12 0a4 4 0 11-8 0 4 4 0 018 0z" /></svg>QR කේතය</button></li>
                    <li><button id="tab-calendar" class="sidebar-item w-full py-3 px-4 rounded-lg text-left transition-colors duration-200 hover:bg-gray-700 flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>දින දර්ශනය</button></li>
                    <li><button id="tab-clock" class="sidebar-item w-full py-3 px-4 rounded-lg text-left transition-colors duration-200 hover:bg-gray-700 flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>ඔරලෝසුව</button></li>
                </ul>
                <div class="mt-8 pt-4 border-t border-gray-600">
                    <button id="logout-button" class="w-full py-3 px-4 rounded-lg text-left text-red-400 hover:bg-gray-700 transition-colors duration-200 flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>ආපසු යන්න</button>
                </div>
            </div>

            <div class="flex-grow">
                <div id="qr-section">
                    <h2 id="qr-title" class="text-3xl font-bold text-white mb-6">QR කේතය</h2>
                    <div class="card p-6 rounded-2xl mb-6">
                        <div class="flex justify-center space-x-4 mb-6">
                            <button id="mode-generator" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg transition-colors duration-200 shadow-md">සාදන්නා</button>
                            <button id="mode-scanner" class="flex-1 bg-gray-700 hover:bg-gray-600 text-gray-300 font-bold py-3 px-4 rounded-lg transition-colors duration-200 shadow-md">ස්කෑනරය</button>
                        </div>
                        <div id="generator-section">
                            <h3 class="text-xl font-bold mb-4" id="qr-gen-title">QR කේත සාදන්න</h3>
                            <div class="flex justify-center space-x-2 mb-4">
                                <button id="gen-mode-url" class="sub-tab-button active flex-1 py-2 px-4 text-sm font-medium bg-blue-600 text-white">වෙබ් ලිපිනය</button>
                                <button id="gen-mode-phone" class="sub-tab-button flex-1 py-2 px-4 text-sm font-medium bg-gray-700 text-gray-300">දුරකථන අංකය</button>
                            </div>
                            <div id="url-generator-section">
                                <input type="url" id="url-input" placeholder="වෙබ් ලිපිනයක් ඇතුළත් කරන්න" class="w-full p-3 mb-4 border border-gray-600 rounded-lg bg-gray-700 text-white">
                            </div>
                            <div id="phone-generator-section" class="hidden">
                                <div class="flex space-x-2 mb-4">
                                    <select id="country-code" class="p-3 border border-gray-600 rounded-lg bg-gray-700 text-white"></select>
                                    <input type="tel" id="phone-input" placeholder="දුරකථන අංකය" class="flex-1 p-3 border border-gray-600 rounded-lg bg-gray-700 text-white">
                                </div>
                            </div>
                            <button id="generate-button" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg">QR කේතය සාදන්න</button>
                            <div id="qrcode" class="mt-6 flex justify-center"></div>
                            <div id="action-buttons" class="flex justify-center space-x-4 mt-4 hidden">
                                <button id="download-button" class="flex-1 bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-4 rounded-lg">බාගත කරන්න</button>
                                <button id="share-button" class="flex-1 bg-sky-600 hover:bg-sky-700 text-white font-bold py-3 px-4 rounded-lg">බෙදාගන්න</button>
                            </div>
                        </div>
                        <div id="scanner-section" class="hidden">
                            <h3 class="text-xl font-bold mb-4" id="qr-scan-title">QR කේත ස්කෑනරය</h3>
                            <div class="relative w-full h-auto max-w-sm mx-auto mb-4">
                                <video id="video-feed" autoplay playsinline class="rounded-lg w-full h-auto"></video>
                                <canvas id="qr-canvas" class="hidden"></canvas>
                            </div>
                            <button id="scan-button" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg mb-2">කැමරාවෙන් ස්කෑන් කරන්න</button>
                            <label class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-4 rounded-lg cursor-pointer block">
                                <input type="file" id="upload-input" accept="image/*" class="hidden">
                                රූපයක් උඩුගත කරන්න
                            </label>
                            <div id="scan-result-container" class="mt-4">
                                <p id="scan-result" class="text-center text-lg font-bold text-gray-300"></p>
                                <button id="open-link-button" class="mt-2 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hidden">වෙබ් ලිපිනය විවෘත කරන්න</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="calendar-section" class="hidden">
                    <h2 id="calendar-title" class="text-3xl font-bold text-white mb-6">දින දර්ශනය</h2>
                    <div class="card p-6 rounded-2xl">
                        <div class="flex justify-between items-center mb-4">
                             <h3 id="current-month-year" class="text-lg font-bold text-white"></h3>
                            <div class="flex items-center space-x-2">
                                <button id="prev-month" class="bg-gray-700 p-2 rounded-full hover:bg-gray-600 transition-colors duration-200"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg></button>
                                <button id="next-month" class="bg-gray-700 p-2 rounded-full hover:bg-gray-600 transition-colors duration-200"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg></button>
                            </div>
                        </div>
                        <div class="mb-4">
                            <label for="country-select" class="block text-gray-400 text-sm mb-1">රට තෝරන්න:</label>
                            <select id="country-select" class="w-full p-2 rounded-lg bg-gray-700 text-white">
                                <option value="LK">ශ්‍රී ලංකාව</option>
                                <option value="IN">ඉන්දියාව</option>
                                <option value="US">එක්සත් ජනපදය</option>
                                <option value="UK">එක්සත් රාජධානිය</option>
                            </select>
                        </div>
                        <div class="grid grid-cols-7 gap-2 text-sm font-semibold text-gray-400">
                            <div id="day-sunday">ඉරිදා</div>
                            <div id="day-monday">සඳුදා</div>
                            <div id="day-tuesday">අඟහරුවාදා</div>
                            <div id="day-wednesday">බදාදා</div>
                            <div id="day-thursday">බ්‍රහස්පතින්දා</div>
                            <div id="day-friday">සිකුරාදා</div>
                            <div id="day-saturday">සෙනසුරාදා</div>
                        </div>
                        <div id="calendar-days" class="grid grid-cols-7 gap-2 text-white mt-2"></div>
                        <div class="mt-4 p-3 bg-gray-700 rounded-lg text-sm text-gray-300 text-left">
                            <p id="holiday-info" class="font-bold">නිවාඩු දින:</p>
                            <ul id="holiday-list" class="list-disc list-inside mt-1"></ul>
                        </div>
                    </div>
                </div>

                <div id="clock-section" class="hidden">
                    <h2 id="clock-title" class="text-3xl font-bold text-white mb-6">ඔරලෝසුව</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="card p-6 rounded-2xl flex flex-col justify-center items-center">
                            <h3 class="text-lg font-bold text-gray-400 mb-2">වර්තමාන වේලාව</h3>
                            <div class="text-5xl md:text-6xl font-extrabold text-white mb-2" id="current-time"></div>
                            <div class="text-sm text-gray-400" id="current-date"></div>
                        </div>
                        <div class="card p-6 rounded-2xl">
                            <h3 id="alarm-title" class="text-lg font-bold text-gray-400 mb-4">එලාම්</h3>
                            <input type="time" id="alarm-time-input" class="p-3 border border-gray-600 rounded-lg w-full mb-4 bg-gray-700 text-white">
                            <button id="set-alarm-button" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg">එලාම් සකසන්න</button>
                            <p id="alarm-status" class="mt-4 text-green-400 font-semibold hidden"></p>
                        </div>
                        <div class="card p-6 rounded-2xl">
                            <h3 id="stopwatch-title" class="text-lg font-bold text-gray-400 mb-4">ස්ටොප් වොච්</h3>
                            <div class="text-5xl font-extrabold text-white mb-4 stopwatch-display">
                                <span id="stopwatch-hr">00</span>:<span id="stopwatch-min">00</span>:<span id="stopwatch-sec">00</span>
                            </div>
                            <div class="flex justify-center space-x-4">
                                <button id="start-stopwatch-button" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg stopwatch-button"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z" /></svg></button>
                                <button id="stop-stopwatch-button" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg stopwatch-button hidden"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M6 5h12v14H6z" /></svg></button>
                                <button id="reset-stopwatch-button" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg stopwatch-button"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 6v6l4.25 2.5m-5.25-9.5a9 9 0 11-9 9 9 9 0 019-9zM2.83 2.83L21.17 21.17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></svg></button>
                            </div>
                        </div>
                        <div class="card p-6 rounded-2xl">
                            <h3 id="world-clock-title" class="text-lg font-bold text-gray-400 mb-4">ලෝක වේලාව</h3>
                            <div id="world-clock-list"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr/dist/jsQR.min.js"></script>
    
    <script>
        const translations = {
            si: {
                appTitle: 'QR කේත, ඔරලෝසු සහ දින දර්ශන යෙදුම',
                authMessage: 'කරුණාකර ඔබගේ නම ඇතුළත් කරන්න.',
                loginButton: 'ඉදිරියට යන්න',
                tabQr: 'QR කේතය',
                tabCalendar: 'දින දර්ශනය',
                tabClock: 'ඔරලෝසුව',
                modeGenerator: 'සාදන්නා',
                modeScanner: 'ස්කෑනරය',
                qrTitle: 'QR කේතය',
                qrGenTitle: 'QR කේත සාදන්න',
                qrScanTitle: 'QR කේත ස්කෑනරය',
                genModeUrl: 'වෙබ් ලිපිනය',
                genModePhone: 'දුරකථන අංකය',
                urlInputPlaceholder: 'වෙබ් ලිපිනයක් ඇතුළත් කරන්න',
                phoneInputPlaceholder: 'දුරකථන අංකය',
                generateButton: 'QR කේතය සාදන්න',
                downloadButton: 'බාගත කරන්න',
                shareButton: 'බෙදාගන්න',
                scanButton: 'කැමරාවෙන් ස්කෑන් කරන්න',
                uploadButton: 'රූපයක් උඩුගත කරන්න',
                openLinkButton: 'වෙබ් ලිපිනය විවෘත කරන්න',
                openDialerButton: 'දුරකථන අංකය අමතන්න',
                calendarTitle: 'දින දර්ශනය',
                selectCountry: 'රට තෝරන්න:',
                days: ['ඉරිදා', 'සඳුදා', 'අඟහරුවාදා', 'බදාදා', 'බ්‍රහස්පතින්දා', 'සිකුරාදා', 'සෙනසුරාදා'],
                months: ['ජනවාරි', 'පෙබරවාරි', 'මාර්තු', 'අප්‍රේල්', 'මැයි', 'ජූනි', 'ජූලි', 'අගෝස්තු', 'සැප්තැම්බර්', 'ඔක්තෝබර්', 'නොවැම්බර්', 'දෙසැම්බර්'],
                holidayInfo: 'නිවාඩු දින:',
                clockTitle: 'ඔරලෝසුව',
                currentTimeTitle: 'වර්තමාන වේලාව',
                alarmTitle: 'එලාම්',
                stopwatchTitle: 'ස්ටොප් වොච්',
                worldClockTitle: 'ලෝක වේලාව',
                setAlarmButton: 'එලාම් සකසන්න',
                startStopwatchButton: 'ආරම්භ කරන්න',
                stopStopwatchButton: 'නවත්වන්න',
                resetStopwatchButton: 'නැවත සකසන්න',
                logoutButton: 'ආපසු යන්න',
                successLogin: (name) => `ආයුබෝවන් ${name}!`,
                errorFillFields: 'කරුණාකර සියලු ක්ෂේත්‍ර පුරවන්න!',
                errorUrlInput: 'කරුණාකර වලංගු වෙබ් ලිපිනයක් ඇතුළත් කරන්න!',
                scanResult: (result) => `ස්කෑන් කරන ලද දත්ත: ${result}`,
                scanError: 'QR කේතයක් හඳුනා ගැනීමට නොහැකි විය.',
                cameraError: 'කැමරාවට ප්‍රවේශ වීමේ දෝෂයක්: ',
                shareFallback: 'ඔබගේ බ්‍රව්සරය බෙදාගැනීමේ විශේෂාංගයට සහය නොදක්වයි.',
                alarmSetMessage: (time) => `එලාම් එක ${time} ට සකසා ඇත.`,
                alarmTitleDialog: 'එලාම් එක නාද වේ!',
                alarmMessageDialog: 'ඔබ නියම කළ වේලාවට එලාම් එක නාද වේ.'
            },
            en: {
                appTitle: 'QR Code, Clock & Calendar App',
                authMessage: 'Please enter your name.',
                loginButton: 'Continue',
                tabQr: 'QR Code',
                tabCalendar: 'Calendar',
                tabClock: 'Clock',
                modeGenerator: 'Generator',
                modeScanner: 'Scanner',
                qrTitle: 'QR Code',
                qrGenTitle: 'QR Code Generator',
                qrScanTitle: 'QR Code Scanner',
                genModeUrl: 'Web URL',
                genModePhone: 'Phone Number',
                urlInputPlaceholder: 'Enter a URL',
                phoneInputPlaceholder: 'Phone Number',
                generateButton: 'Generate QR Code',
                downloadButton: 'Download',
                shareButton: 'Share',
                scanButton: 'Scan with Camera',
                uploadButton: 'Upload Image',
                openLinkButton: 'Open Link',
                openDialerButton: 'Call Phone Number',
                calendarTitle: 'Calendar',
                selectCountry: 'Select Country:',
                days: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
                months: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
                holidayInfo: 'Holidays:',
                clockTitle: 'Clock',
                currentTimeTitle: 'Current Time',
                alarmTitle: 'Alarm',
                stopwatchTitle: 'Stopwatch',
                worldClockTitle: 'World Clock',
                setAlarmButton: 'Set Alarm',
                startStopwatchButton: 'Start',
                stopStopwatchButton: 'Stop',
                resetStopwatchButton: 'Reset',
                logoutButton: 'Go Back',
                successLogin: (name) => `Hello, ${name}!`,
                errorFillFields: 'Please fill in all fields!',
                errorUrlInput: 'Please enter a valid website URL!',
                scanResult: (result) => `Scanned Data: ${result}`,
                scanError: 'Could not detect a QR code.',
                cameraError: 'Error accessing the camera: ',
                shareFallback: 'Your browser does not support sharing.',
                alarmSetMessage: (time) => `Alarm is set for ${time}.`,
                alarmTitleDialog: 'Alarm!',
                alarmMessageDialog: 'The alarm is ringing at the set time.'
            },
            ta: {
                appTitle: 'QR குறியீடு, கடிகாரம் & நாட்காட்டி செயலி',
                authMessage: 'உங்கள் பெயரை உள்ளிடவும்.',
                loginButton: 'தொடரவும்',
                tabQr: 'QR குறியீடு',
                tabCalendar: 'நாட்காட்டி',
                tabClock: 'கடிகாரம்',
                modeGenerator: 'உருவாக்கி',
                modeScanner: 'ஸ்கேனர்',
                qrTitle: 'QR குறியீடு',
                qrGenTitle: 'QR குறியீடு உருவாக்குங்கள்',
                qrScanTitle: 'QR குறியீடு ஸ்கேனர்',
                genModeUrl: 'இணைய முகவரி',
                genModePhone: 'தொலைபேசி எண்',
                urlInputPlaceholder: 'இணைய முகவரியை உள்ளிடவும்',
                phoneInputPlaceholder: 'தொலைபேசி எண்',
                generateButton: 'QR குறியீட்டை உருவாக்குங்கள்',
                downloadButton: 'பதிவிறக்கு',
                shareButton: 'பகிர்',
                scanButton: 'கேமராவால் ஸ்கேன் செய்',
                uploadButton: 'படத்தை பதிவேற்று',
                openLinkButton: 'இணைப்பை திற',
                openDialerButton: 'தொலைபேசி எண்ணை அழைக்கவும்',
                calendarTitle: 'நாட்காட்டி',
                selectCountry: 'நாட்டைத் தேர்ந்தெடுக்கவும்:',
                days: ['ஞாயிறு', 'திங்கள்', 'செவ்வாய்', 'புதன்', 'வியாழன்', 'வெள்ளி', 'சனி'],
                months: ['ஜனவரி', 'பிப்ரவரி', 'மார்ச்', 'ஏப்ரல்', 'மே', 'ஜூன்', 'ஜூலை', 'ஆகஸ்ட்', 'செப்டம்பர்', 'அக்டோபர்', 'நவம்பர்', 'டிசம்பர்'],
                holidayInfo: 'விடுமுறை நாட்கள்:',
                clockTitle: 'கடிகாரம்',
                currentTimeTitle: 'தற்போதைய நேரம்',
                alarmTitle: 'அலாரம்',
                stopwatchTitle: 'நிறுத்து கடிகாரம்',
                worldClockTitle: 'உலக நேரம்',
                setAlarmButton: 'அலாரத்தை அமை',
                startStopwatchButton: 'தொடங்கு',
                stopStopwatchButton: 'நிறுத்து',
                resetStopwatchButton: 'மீட்டமை',
                logoutButton: 'பின்னோக்கிச் செல்',
                successLogin: (name) => `வணக்கம், ${name}!`,
                errorFillFields: 'அனைத்து புலங்களையும் பூர்த்தி செய்யவும்!',
                errorUrlInput: 'சரியான இணைய முகவரியை உள்ளிடவும்!',
                scanResult: (result) => `ஸ்கேன் செய்யப்பட்ட தரவு: ${result}`,
                scanError: 'QR குறியீட்டைக் கண்டறிய முடியவில்லை.',
                cameraError: 'கேமராவை அணுகுவதில் பிழை: ',
                shareFallback: 'உங்கள் உலாவி பகிர்தல் அம்சத்தை ஆதரிக்கவில்லை.',
                alarmSetMessage: (time) => `அலாரம் ${time} க்கு அமைக்கப்பட்டுள்ளது.`,
                alarmTitleDialog: 'அலாரம்!',
                alarmMessageDialog: 'அலாரம் ஒலிக்கும் நேரம்.'
            }
        };
        const countryCodes = [
            { code: '+94', name: 'Sri Lanka' },
            { code: '+91', name: 'India' },
            { code: '+1', name: 'USA' },
            { code: '+44', name: 'UK' },
            { code: '+61', name: 'Australia' }
        ];
        const worldClockTimezones = [
            { name: 'New York', timezone: 'America/New_York' },
            { name: 'London', timezone: 'Europe/London' },
            { name: 'Tokyo', timezone: 'Asia/Tokyo' },
            { name: 'Sydney', timezone: 'Australia/Sydney' },
            { name: 'Dubai', timezone: 'Asia/Dubai' },
            { name: 'Colombo', timezone: 'Asia/Colombo' }
        ];

        const holidays = {
            'LK': [
            { date: '2025-01-13', name: 'Duruthu Full Moon Poya Day' },
                { date: '2025-01-14', name: 'Tamil Thai Pongal Day' },
                { date: '2025-02-04', name: 'National Day' },
                { date: '2025-02-12', name: 'Navam Full Moon Poya Day' },
                { date: '2025-02-26', name: 'Mahasivarathri Day' },
                { date: '2025-03-13', name: 'Madin Full Moon Poya Day' },
                { date: '2025-03-31', name: 'Eid al-Fitr' },
                { date: '2025-04-12', name: 'Bak Full Moon Poya Day' },
                { date: '2025-04-13', name: 'Sinhala and Tamil New Year' },
                { date: '2025-04-14', name: 'Sinhala and Tamil New Year' },
                { date: '2025-04-18', name: 'Duruthu Full Moon Poya Day' },
                { date: '2025-05-01', name: 'May Day' },
                { date: '2025-05-12', name: 'Vesak Full Moon Poya Day' },
                { date: '2025-05-13', name: 'Day after Vesak Full Moon Poya Day' },
                { date: '2025-06-07', name: 'Eid al-Adha' },
                { date: '2025-06-10', name: 'Poson Full Moon Poya Day' },
                { date: '2025-07-10', name: 'Esala Full Moon Poya Day' },
                { date: '2025-08-08', name: 'Nikini Full Moon Poya Day' },
                { date: '2025-09-05', name: 'Milad-Un-Nabi' },
                { date: '2025-09-07', name: 'Binara Full Moon Poya Day' },
                { date: '2025-10-06', name: 'Vap Full Moon Poya Day' },
                { date: '2025-10-20', name: 'Deepavali' },
                { date: '2025-11-05', name: 'Il Full Moon Poya Day' },
                { date: '2025-12-04', name: 'Unduvap Full Moon Poya Day' },
                { date: '2025-12-25', name: 'Christmas Day' },
            ],
            'IN': [
                { date: '2025-01-26', name: 'Republic Day' },
                { date: '2025-08-15', name: 'Independence Day' },
                { date: '2025-10-02', name: 'Gandhi Jayanti' },
                { date: '2025-10-21', name: 'Diwali' },
            ],
            'US': [
                { date: '2025-01-01', name: 'New Year\'s Day' },
                { date: '2025-01-20', name: 'Martin Luther King Jr. Day' },
                { date: '2025-02-17', name: 'Presidents\' Day' },
                { date: '2025-07-04', name: 'Independence Day' },
                { date: '2025-09-01', name: 'Labor Day' },
                { date: '2025-11-27', name: 'Thanksgiving Day' },
                { date: '2025-12-25', name: 'Christmas Day' }
            ],
            'UK': [
                { date: '2025-01-01', name: 'New Year\'s Day' },
                { date: '2025-04-18', name: 'Good Friday' },
                { date: '2025-04-21', name: 'Easter Monday' },
                { date: '2025-05-05', name: 'Early May Bank Holiday' },
                { date: '2025-05-26', name: 'Spring Bank Holiday' },
                { date: '2025-08-25', name: 'Summer Bank Holiday' },
                { date: '2025-12-25', name: 'Christmas Day' },
                { date: '2025-12-26', name: 'Boxing Day' }
            ]
        };

        const alarmSound = new Audio('https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3'); // Example alarm sound
        alarmSound.loop = true;

        let currentLang = 'si';
        let currentGeneratorMode = 'url';
        let currentUser = null;
        let videoStream = null;
        let lastScannedData = '';
        let currentDate = new Date();
        let currentCountry = 'LK';
        let stopwatchInterval = null;
        let stopwatchTime = 0;
        let alarmInterval = null;

        const elements = {
            authContainer: document.getElementById('auth-container'),
            mainAppContainer: document.getElementById('main-app-container'),
            authTitle: document.getElementById('auth-title'),
            authMessage: document.getElementById('auth-message'),
            userNameInput: document.getElementById('user-name'),
            loginButton: document.getElementById('login-button'),
            langSi: document.getElementById('lang-si'),
            langEn: document.getElementById('lang-en'),
            langTa: document.getElementById('lang-ta'),
            userInfoDisplay: document.getElementById('user-info'),
            tabQr: document.getElementById('tab-qr'),
            tabCalendar: document.getElementById('tab-calendar'),
            tabClock: document.getElementById('tab-clock'),
            qrSection: document.getElementById('qr-section'),
            calendarSection: document.getElementById('calendar-section'),
            clockSection: document.getElementById('clock-section'),
            modeGeneratorButton: document.getElementById('mode-generator'),
            modeScannerButton: document.getElementById('mode-scanner'),
            generatorSection: document.getElementById('generator-section'),
            scannerSection: document.getElementById('scanner-section'),
            qrTitle: document.getElementById('qr-title'),
            qrGenTitle: document.getElementById('qr-gen-title'),
            qrScanTitle: document.getElementById('qr-scan-title'),
            genModeUrlButton: document.getElementById('gen-mode-url'),
            genModePhoneButton: document.getElementById('gen-mode-phone'),
            urlGeneratorSection: document.getElementById('url-generator-section'),
            phoneGeneratorSection: document.getElementById('phone-generator-section'),
            urlInput: document.getElementById('url-input'),
            phoneInput: document.getElementById('phone-input'),
            countryCodeSelect: document.getElementById('country-code'),
            generateButton: document.getElementById('generate-button'),
            qrcodeContainer: document.getElementById('qrcode'),
            actionButtons: document.getElementById('action-buttons'),
            downloadButton: document.getElementById('download-button'),
            shareButton: document.getElementById('share-button'),
            videoFeed: document.getElementById('video-feed'),
            qrCanvas: document.getElementById('qr-canvas'),
            scanButton: document.getElementById('scan-button'),
            uploadInput: document.getElementById('upload-input'),
            scanResult: document.getElementById('scan-result'),
            openLinkButton: document.getElementById('open-link-button'),
            logoutButton: document.getElementById('logout-button'),
            calendarTitle: document.getElementById('calendar-title'),
            prevMonthButton: document.getElementById('prev-month'),
            nextMonthButton: document.getElementById('next-month'),
            currentMonthYear: document.getElementById('current-month-year'),
            calendarDays: document.getElementById('calendar-days'),
            holidayInfo: document.getElementById('holiday-info'),
            holidayList: document.getElementById('holiday-list'),
            countrySelect: document.getElementById('country-select'),
            clockTitle: document.getElementById('clock-title'),
            currentTimeTitle: document.getElementById('current-time-title'),
            alarmTitle: document.getElementById('alarm-title'),
            stopwatchTitle: document.getElementById('stopwatch-title'),
            worldClockTitle: document.getElementById('world-clock-title'),
            currentTimeDisplay: document.getElementById('current-time'),
            currentDateDisplay: document.getElementById('current-date'),
            worldClockList: document.getElementById('world-clock-list'),
            alarmTimeInput: document.getElementById('alarm-time-input'),
            setAlarmButton: document.getElementById('set-alarm-button'),
            alarmStatus: document.getElementById('alarm-status'),
            stopwatchDisplay: document.getElementById('stopwatch-display'),
            stopwatchHr: document.getElementById('stopwatch-hr'),
            stopwatchMin: document.getElementById('stopwatch-min'),
            stopwatchSec: document.getElementById('stopwatch-sec'),
            startStopwatchButton: document.getElementById('start-stopwatch-button'),
            stopStopwatchButton: document.getElementById('stop-stopwatch-button'),
            resetStopwatchButton: document.getElementById('reset-stopwatch-button')
        };
        const canvasCtx = elements.qrCanvas.getContext('2d');
        
        function updateLanguage() {
            const t = translations[currentLang];
            elements.authTitle.textContent = t.appTitle;
            elements.authMessage.textContent = t.authMessage;
            elements.loginButton.textContent = t.loginButton;
            elements.tabQr.textContent = t.tabQr;
            elements.tabCalendar.textContent = t.tabCalendar;
            elements.tabClock.textContent = t.tabClock;
            elements.modeGeneratorButton.textContent = t.modeGenerator;
            elements.modeScannerButton.textContent = t.modeScanner;
            elements.qrTitle.textContent = t.qrTitle;
            elements.qrGenTitle.textContent = t.qrGenTitle;
            elements.qrScanTitle.textContent = t.qrScanTitle;
            elements.genModeUrlButton.textContent = t.genModeUrl;
            elements.genModePhoneButton.textContent = t.genModePhone;
            elements.urlInput.placeholder = t.urlInputPlaceholder;
            elements.phoneInput.placeholder = t.phoneInputPlaceholder;
            elements.generateButton.textContent = t.generateButton;
            elements.downloadButton.textContent = t.downloadButton;
            elements.shareButton.textContent = t.shareButton;
            elements.scanButton.textContent = t.scanButton;
            document.querySelector('#upload-input').labels[0].textContent = t.uploadButton;
            elements.openLinkButton.textContent = t.openLinkButton;
            elements.calendarTitle.textContent = t.calendarTitle;
            document.querySelector('label[for="country-select"]').textContent = t.selectCountry;
            const dayNames = ['day-sunday', 'day-monday', 'day-tuesday', 'day-wednesday', 'day-thursday', 'day-friday', 'day-saturday'];
            for (let i = 0; i < 7; i++) {
                document.getElementById(dayNames[i]).textContent = t.days[i];
            }
            elements.holidayInfo.textContent = t.holidayInfo;
            elements.clockTitle.textContent = t.clockTitle;
            elements.alarmTitle.textContent = t.alarmTitle;
            elements.stopwatchTitle.textContent = t.stopwatchTitle;
            elements.worldClockTitle.textContent = t.worldClockTitle;
            elements.setAlarmButton.textContent = t.setAlarmButton;
            elements.startStopwatchButton.textContent = t.startStopwatchButton;
            elements.stopStopwatchButton.textContent = t.stopStopwatchButton;
            elements.resetStopwatchButton.textContent = t.resetStopwatchButton;
            elements.logoutButton.textContent = t.logoutButton;
            document.querySelectorAll('.lang-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`lang-${currentLang}`).classList.add('active');
        }

        function populateCountryCodes() {
            elements.countryCodeSelect.innerHTML = '';
            countryCodes.forEach(country => {
                const option = document.createElement('option');
                option.value = country.code;
                option.textContent = `${country.name} (${country.code})`;
                elements.countryCodeSelect.appendChild(option);
            });
            elements.countryCodeSelect.value = '+94';
        }

        function toggleUI(loggedIn = false, name = null) {
            elements.authContainer.classList.toggle('hidden', loggedIn);
            elements.mainAppContainer.classList.toggle('hidden', !loggedIn);
            if (loggedIn) {
                elements.userInfoDisplay.textContent = translations[currentLang].successLogin(name);
                showTab('qr');
            } else {
                elements.userNameInput.value = '';
                if (videoStream) {
                    videoStream.getTracks().forEach(track => track.stop());
                }
                if (stopwatchInterval) {
                    clearInterval(stopwatchInterval);
                }
            }
            updateLanguage();
        }

        function showTab(tabId) {
            const tabs = ['qr', 'calendar', 'clock'];
            tabs.forEach(id => {
                document.getElementById(`${id}-section`).classList.toggle('hidden', id !== tabId);
                document.getElementById(`tab-${id}`).classList.toggle('active', id === tabId);
                document.getElementById(`tab-${id}`).classList.toggle('bg-indigo-600', id === tabId);
                document.getElementById(`tab-${id}`).classList.toggle('text-white', id === tabId);
                document.getElementById(`tab-${id}`).classList.toggle('bg-gray-700', id !== tabId);
                document.getElementById(`tab-${id}`).classList.toggle('text-gray-300', id !== tabId);
            });
            if (tabId === 'calendar') {
                renderCalendar();
            }
            if (tabId === 'clock') {
                updateClock();
            }
        }

        elements.loginButton.addEventListener('click', () => {
            const name = elements.userNameInput.value.trim();
            if (name) {
                currentUser = { name: name };
                toggleUI(true, currentUser.name);
            } else {
                alert(translations[currentLang].errorFillFields);
            }
        });

        elements.logoutButton.addEventListener('click', () => {
            currentUser = null;
            toggleUI(false);
        });

        document.getElementById('lang-si').addEventListener('click', () => {
            currentLang = 'si';
            updateLanguage();
        });
        document.getElementById('lang-en').addEventListener('click', () => {
            currentLang = 'en';
            updateLanguage();
        });
        document.getElementById('lang-ta').addEventListener('click', () => {
            currentLang = 'ta';
            updateLanguage();
        });

        // Main tab events
        elements.tabQr.addEventListener('click', () => showTab('qr'));
        elements.tabCalendar.addEventListener('click', () => showTab('calendar'));
        elements.tabClock.addEventListener('click', () => showTab('clock'));

        // QR Section events
        elements.modeGeneratorButton.addEventListener('click', () => {
            elements.generatorSection.classList.remove('hidden');
            elements.scannerSection.classList.add('hidden');
            elements.modeGeneratorButton.classList.add('bg-indigo-600', 'text-white');
            elements.modeGeneratorButton.classList.remove('bg-gray-700', 'text-gray-300');
            elements.modeScannerButton.classList.add('bg-gray-700', 'text-gray-300');
            elements.modeScannerButton.classList.remove('bg-indigo-600', 'text-white');
            if (videoStream) videoStream.getTracks().forEach(track => track.stop());
        });

        elements.modeScannerButton.addEventListener('click', () => {
            elements.scannerSection.classList.remove('hidden');
            elements.generatorSection.classList.add('hidden');
            elements.modeScannerButton.classList.add('bg-indigo-600', 'text-white');
            elements.modeScannerButton.classList.remove('bg-gray-700', 'text-gray-300');
            elements.modeGeneratorButton.classList.add('bg-gray-700', 'text-gray-300');
            elements.modeGeneratorButton.classList.remove('bg-indigo-600', 'text-white');
            if (videoStream) videoStream.getTracks().forEach(track => track.stop());
            elements.scanResult.textContent = '';
            elements.openLinkButton.classList.add('hidden');
        });

        elements.genModeUrlButton.addEventListener('click', () => {
            currentGeneratorMode = 'url';
            elements.urlGeneratorSection.classList.remove('hidden');
            elements.phoneGeneratorSection.classList.add('hidden');
            elements.genModeUrlButton.classList.add('bg-blue-600', 'text-white');
            elements.genModeUrlButton.classList.remove('bg-gray-700', 'text-gray-300');
            elements.genModePhoneButton.classList.add('bg-gray-700', 'text-gray-300');
            elements.genModePhoneButton.classList.remove('bg-blue-600', 'text-white');
            elements.qrcodeContainer.innerHTML = '';
            elements.actionButtons.classList.add('hidden');
        });

        elements.genModePhoneButton.addEventListener('click', () => {
            currentGeneratorMode = 'phone';
            elements.urlGeneratorSection.classList.add('hidden');
            elements.phoneGeneratorSection.classList.remove('hidden');
            elements.genModePhoneButton.classList.add('bg-blue-600', 'text-white');
            elements.genModePhoneButton.classList.remove('bg-gray-700', 'text-gray-300');
            elements.genModeUrlButton.classList.add('bg-gray-700', 'text-gray-300');
            elements.genModeUrlButton.classList.remove('bg-blue-600', 'text-white');
            elements.qrcodeContainer.innerHTML = '';
            elements.actionButtons.classList.add('hidden');
        });

        elements.generateButton.addEventListener('click', () => {
            let qrText = '';
            if (currentGeneratorMode === 'url') {
                let url = elements.urlInput.value.trim();
                if (url) {
                    const urlPattern = /^(http|https):\/\/[^ "]+$/;
                    if (!urlPattern.test(url)) {
                        if (!url.startsWith('http://') && !url.startsWith('https://')) {
                            url = 'https://' + url;
                        }
                        if (!urlPattern.test(url)) {
                            alert(translations[currentLang].errorUrlInput);
                            return;
                        }
                    }
                    qrText = url;
                } else {
                    alert(translations[currentLang].errorFillFields);
                    return;
                }
            } else if (currentGeneratorMode === 'phone') {
                const countryCode = elements.countryCodeSelect.value;
                const phoneNumber = elements.phoneInput.value.trim();
                if (phoneNumber) {
                    qrText = `tel:${countryCode}${phoneNumber.startsWith('0') ? phoneNumber.substring(1) : phoneNumber}`;
                } else {
                    alert(translations[currentLang].errorFillFields);
                    return;
                }
            }
            if (qrText) {
                elements.qrcodeContainer.innerHTML = '';
                new QRCode(elements.qrcodeContainer, { text: qrText, width: 256, height: 256 });
                elements.actionButtons.classList.remove('hidden');
                lastScannedData = qrText;
            }
        });

        elements.downloadButton.addEventListener('click', () => {
            const canvas = elements.qrcodeContainer.querySelector('canvas');
            if (canvas) {
                const url = canvas.toDataURL('image/png');
                const a = document.createElement('a');
                a.href = url;
                a.download = 'qrcode.png';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            }
        });

        elements.shareButton.addEventListener('click', async () => {
            const canvas = elements.qrcodeContainer.querySelector('canvas');
            if (!canvas) return;
            try {
                const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
                const file = new File([blob], 'qrcode.png', { type: 'image/png' });
                if (navigator.canShare && navigator.canShare({ files: [file] })) {
                    await navigator.share({ files: [file], title: 'QR Code' });
                } else {
                    alert(translations[currentLang].shareFallback);
                }
            } catch (error) { console.error('Sharing failed:', error); }
        });

        elements.scanButton.addEventListener('click', async () => {
            try {
                videoStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
                elements.videoFeed.srcObject = videoStream;
                elements.videoFeed.play();
                requestAnimationFrame(tick);
                elements.scanResult.textContent = '';
                elements.openLinkButton.classList.add('hidden');
            } catch (error) {
                console.error(translations[currentLang].cameraError, error);
                elements.scanResult.textContent = translations[currentLang].cameraError + error.message;
            }
        });

        function tick() {
            if (elements.videoFeed.readyState === elements.videoFeed.HAVE_ENOUGH_DATA) {
                elements.qrCanvas.height = elements.videoFeed.videoHeight;
                elements.qrCanvas.width = elements.videoFeed.videoWidth;
                canvasCtx.drawImage(elements.videoFeed, 0, 0, elements.qrCanvas.width, elements.qrCanvas.height);
                const imageData = canvasCtx.getImageData(0, 0, elements.qrCanvas.width, elements.qrCanvas.height);
                const code = jsQR(imageData.data, imageData.width, imageData.height);
                if (code) {
                    if (code.data !== lastScannedData) {
                        lastScannedData = code.data;
                        elements.scanResult.textContent = translations[currentLang].scanResult(code.data);
                        elements.openLinkButton.classList.remove('hidden');
                        if (videoStream) videoStream.getTracks().forEach(track => track.stop());
                        elements.openLinkButton.textContent = code.data.startsWith('tel:') ? translations[currentLang].openDialerButton : translations[currentLang].openLinkButton;
                        elements.openLinkButton.onclick = () => { window.open(code.data.startsWith('tel:') ? code.data : code.data.startsWith('http') ? code.data : `http://${code.data}`, '_blank'); };
                    }
                }
                requestAnimationFrame(tick);
            }
        }

        elements.uploadInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
                const image = new Image();
                image.onload = () => {
                    elements.qrCanvas.width = image.width;
                    elements.qrCanvas.height = image.height;
                    canvasCtx.drawImage(image, 0, 0, image.width, image.height);
                    const imageData = canvasCtx.getImageData(0, 0, elements.qrCanvas.width, elements.qrCanvas.height);
                    const code = jsQR(imageData.data, imageData.width, imageData.height);
                    if (code) {
                        elements.scanResult.textContent = translations[currentLang].scanResult(code.data);
                        elements.openLinkButton.classList.remove('hidden');
                        elements.openLinkButton.textContent = code.data.startsWith('tel:') ? translations[currentLang].openDialerButton : translations[currentLang].openLinkButton;
                        elements.openLinkButton.onclick = () => { window.open(code.data.startsWith('tel:') ? code.data : code.data.startsWith('http') ? code.data : `http://${code.data}`, '_blank'); };
                    } else {
                        elements.scanResult.textContent = translations[currentLang].scanError;
                        elements.openLinkButton.classList.add('hidden');
                    }
                };
                image.src = event.target.result;
            };
            reader.readAsDataURL(file);
        });

        // Calendar functions
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            elements.currentMonthYear.textContent = `${translations[currentLang].months[month]} ${year}`;
            elements.calendarDays.innerHTML = '';
            for (let i = 0; i < firstDay; i++) {
                elements.calendarDays.innerHTML += '<div></div>';
            }
            const countryHolidays = holidays[currentCountry] || [];
            const monthHolidays = countryHolidays.filter(h => {
                const holidayDate = new Date(h.date);
                return holidayDate.getFullYear() === year && holidayDate.getMonth() === month;
            });
            elements.holidayList.innerHTML = '';
            if (monthHolidays.length > 0) {
                elements.holidayList.parentElement.classList.remove('hidden');
                monthHolidays.forEach(h => {
                    const li = document.createElement('li');
                    li.textContent = `${new Date(h.date).getDate()} - ${h.name}`;
                    elements.holidayList.appendChild(li);
                });
            } else {
                elements.holidayList.parentElement.classList.add('hidden');
            }
            for (let day = 1; day <= daysInMonth; day++) {
                const dayDiv = document.createElement('div');
                dayDiv.textContent = day;
                dayDiv.className = 'py-2 rounded-lg text-center';
                const holiday = monthHolidays.find(h => new Date(h.date).getDate() === day);
                if (holiday) {
                    dayDiv.classList.add('holiday');
                }
                elements.calendarDays.appendChild(dayDiv);
            }
        }

        elements.prevMonthButton.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            if (currentDate.getFullYear() < 2000) {
                currentDate.setFullYear(2000);
                currentDate.setMonth(0);
            }
            renderCalendar();
        });

        elements.nextMonthButton.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        });
        
        elements.countrySelect.addEventListener('change', (e) => {
            currentCountry = e.target.value;
            renderCalendar();
        });

        // Clock functions
        function updateClock() {
            const now = new Date();
            elements.currentTimeDisplay.textContent = now.toLocaleTimeString(currentLang === 'si' ? 'si-LK' : currentLang === 'ta' ? 'ta-LK' : 'en-US', { hour12: true });
            elements.currentDateDisplay.textContent = now.toLocaleDateString(currentLang === 'si' ? 'si-LK' : currentLang === 'ta' ? 'ta-LK' : 'en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            
            elements.worldClockList.innerHTML = '';
            worldClockTimezones.forEach(tz => {
                const cityTime = new Date().toLocaleTimeString(currentLang === 'si' ? 'si-LK' : currentLang === 'ta' ? 'ta-LK' : 'en-US', { timeZone: tz.timezone, hour12: true });
                const div = document.createElement('div');
                div.className = 'py-2 border-b border-gray-600 last:border-b-0 text-gray-300';
                div.textContent = `${tz.name}: ${cityTime}`;
                elements.worldClockList.appendChild(div);
            });
            setTimeout(updateClock, 1000);
        }

        // Alarm functions
        elements.setAlarmButton.addEventListener('click', () => {
            const alarmTime = elements.alarmTimeInput.value;
            if (!alarmTime) {
                alert(translations[currentLang].errorFillFields);
                return;
            }
            elements.alarmStatus.textContent = translations[currentLang].alarmSetMessage(alarmTime);
            elements.alarmStatus.classList.remove('hidden');
            const [hours, minutes] = alarmTime.split(':').map(Number);
            if (alarmInterval) clearInterval(alarmInterval);
            alarmInterval = setInterval(() => {
                const now = new Date();
                if (now.getHours() === hours && now.getMinutes() === minutes && now.getSeconds() === 0) {
                    alarmSound.play();
                    alert(`${translations[currentLang].alarmTitleDialog}\n${translations[currentLang].alarmMessageDialog}`);
                    alarmSound.pause();
                    alarmSound.currentTime = 0;
                    clearInterval(alarmInterval);
                    elements.alarmStatus.classList.add('hidden');
                }
            }, 1000);
        });

        // Stopwatch functions
        elements.startStopwatchButton.addEventListener('click', () => {
            if (!stopwatchInterval) {
                let startTime = Date.now() - stopwatchTime;
                stopwatchInterval = setInterval(() => {
                    stopwatchTime = Date.now() - startTime;
                    const totalSeconds = Math.floor(stopwatchTime / 1000);
                    const hours = Math.floor(totalSeconds / 3600);
                    const minutes = Math.floor((totalSeconds % 3600) / 60);
                    const seconds = totalSeconds % 60;
                    elements.stopwatchHr.textContent = String(hours).padStart(2, '0');
                    elements.stopwatchMin.textContent = String(minutes).padStart(2, '0');
                    elements.stopwatchSec.textContent = String(seconds).padStart(2, '0');
                }, 1000);
                elements.startStopwatchButton.classList.add('hidden');
                elements.stopStopwatchButton.classList.remove('hidden');
            }
        });

        elements.stopStopwatchButton.addEventListener('click', () => {
            if (stopwatchInterval) {
                clearInterval(stopwatchInterval);
                stopwatchInterval = null;
                elements.startStopwatchButton.classList.remove('hidden');
                elements.stopStopwatchButton.classList.add('hidden');
            }
        });

        elements.resetStopwatchButton.addEventListener('click', () => {
            clearInterval(stopwatchInterval);
            stopwatchInterval = null;
            stopwatchTime = 0;
            elements.stopwatchHr.textContent = '00';
            elements.stopwatchMin.textContent = '00';
            elements.stopwatchSec.textContent = '00';
            elements.startStopwatchButton.classList.remove('hidden');
            elements.stopStopwatchButton.classList.add('hidden');
        });

        // Initial setup
        populateCountryCodes();
        updateLanguage();
    </script>
</body>
</html>
